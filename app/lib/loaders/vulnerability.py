from app.lib import files, helpers
from app.lib.loaders import loader
from app.models import *


class VulnerabilityLoader(loader.Loader):
    def _load(self):
        count = 0

        f = files.Files(self.settings)
        for (source, cve, bug_id) in f.get_vulnerabilities():
            b = helpers.get_row(Bug, id=bug_id)
            if b is None:
                b = Bug(id=bug_id, type='Bug-Security', status='Redacted')
                b.save()

            v = Vulnerability(cve=cve, source=source, bug=b)
            v.save()
            count += 1

        return count
